\pdfoutput=1
\documentclass{article}
\usepackage{fullpage}
\usepackage{amsmath, amssymb, amsthm}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[numbers]{natbib}
\usepackage{csquotes}
\usepackage{url}
\usepackage{hyperref}
\usepackage{cleveref}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{algorithmicx}
\setlength{\parskip}{0.5em}
\setlength{\parindent}{0pt}
\theoremstyle{plain}
\theoremstyle{definition}
\newtheorem{definition}{Definition}
\newtheorem{identity}{Identity}
\newtheorem{conjecture}{Conjecture}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}{Proposition}
\newtheorem{example}{Example}
\crefname{definition}{Definition}{Definitions}
\crefname{identity}{Identity}{Identities}
\crefname{conjecture}{Conjecture}{Conjectures}
\crefname{theorem}{Theorem}{Theorems}
\crefname{lemma}{Lemma}{Lemmas}
\crefname{proposition}{Proposition}{Propositions}
\crefname{example}{Example}{Examples}
\usepackage{graphicx}
\usepackage{multicol}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\totient}[1]{\phi\left({#1}\right)}
\newcommand{\bigO}[1]{O(#1)}
\newcommand{\softO}[1]{\tilde{O}(#1)}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\Zn}{\Z/n}
\newcommand{\Zx}{\Z[x]}
\newcommand{\Znx}{\Z_n[x]}
\newcommand{\Rx}{R}
\newcommand{\Mx}{\Z_n[x]/(x^d-2)}
\newcommand{\ord}[2]{\text{ord}_\text{#1}\left((#2)\right)}
\newcommand{\dtotient}[3]{\sigma_{#1}( #2^{\floor{\frac{1}{#3}}} )}
\newcommand{\ordn}[1]{\text{ord}_n\left({#1}\right)}
\newcommand{\indicator}[2]{\substack{#1 \\ #2}}
\newcommand{\glaisher}[2]{\left[ \begin{array}{c} #1 \\ #2 \end{array} \right]}
\newcommand{\kronecker}[2]{\left(#1\mid#2\right)}

\title{An Efficient Deterministic Primality Test}
\author{Joseph M. Shunia}
\date{December 2023 \\ \small Revised: January 2024 \normalsize}

\begin{document}

\maketitle

\begin{abstract}
A deterministic primality test with a polynomial time complexity of $\tilde{O}(\log^3(n))$ is presented. The test posits that an integer $n$ satisfying the conditions of the main theorem is prime. Our test is a variation of Agrawal's conjecture, which says that $n$ is prime if and only if the polynomial congruence $(x - 1)^n \equiv x^n - 1 \pmod{n}$ holds in the quotient ring $\mathbb{Z}[x]/(x^r - 1)$, where $r$ is an integer such that $n^2 \not\equiv 1 \pmod{r}$. Operating in the quotient ring $\mathbb{Z}[x]/(x^r - 1)$, Argawal's conjecture is premised on the unique properties of roots of unity. We instead use the ring $\mathbb{Z}[x]/(x^d - 2)$, where $d$ is the least prime integer such that $n \not\equiv 1 \pmod{d}$. In doing so, we replace the roots of unity with roots of $2$. This seemingly subtle change enables us to exploit certain number theoretic properties of Fermat pseudoprimes to base $2$, leading to a deterministic primality test.
\end{abstract}

\section{Introduction}

Primality testing has seen remarkable advancements over the past few decades. A significant breakthrough in this field was the AKS primality test, introduced by Agrawal, Kayal, and Saxena (2002) \cite{aks2002}. The AKS test was the first to offer determinism and polynomial-time complexity, a monumental achievement that resolved a longstanding open question in computational number theory \cite{goldreich2008}. However, despite its theoretical importance, the AKS test has practical limitations due to its relatively high polynomial time complexity, rendering it inefficient for most applications. Agrawal, Kayal, and Saxena gave a time complexity of $\tilde{O}(\log^{12}(n))$ for the AKS test \cite{aks2002}. This bound was lowered significantly by Lenstra and Pomerance (2011) to $\tilde{O}(\log^6(n))$ \cite{lenstra2011}. Despite this reduction, AKS remains impractical and is mostly unused.

In the field of cryptography, the unique properties of prime numbers are widely exploited to create cryptographic primitives. It is often the case that many large primes must be generated in rapid succession \cite{lenstra1987}. To make these cryptographic operations practical, fast probabilistic primality tests such as the Baille-PSW primality test (BPSW) \cite{baillie1980} or Miller-Rabin (MR) \cite{rabin1980} \cite{miller1976} are used instead of AKS when searching for large primes. Probabilistic primality tests are by definition non-deterministic and may erroneously report a composite integer as being prime. Composite integers which pass a probabilistic primality test are relatively rare and are known as pseudoprimes (PSPs) for the respective test \cite{wagstaff1983}. When generating primes for cryptographic purposes, probabilistic primality tests are often combined or repeated with different parameters in order to achieve an acceptable error-bound that makes it almost certain that no composite integer will pass. However, reducing the error-bound requires additional compute and increases running-time, creating a trade-off.

We present a new deterministic primality test that operates in polynomial time with a time complexity of $\tilde{O}(\log^3(n))$. This efficiency gain opens new avenues for practical applications, particularly in cryptography, where fast and reliable primality testing is desirable \cite{pomerance1984}. 

Our test is based on a famous conjecture issued by Manindra Argawal while he was an undergraduate student \cite{aks2002}. Let $n$ and $r$ be two coprime positive integers. If the following polynomial congruence holds, then $n$ is prime or $n^2 = 1 \pmod{r}$:
\begin{align}
    (x - 1)^n \equiv x^n - 1 \pmod{n, x^r - 1}
\end{align}

We alter the conditions slightly to use roots of $2$ instead of roots of unity. This substitution allows us to leverage specific number theoretic properties unique to Fermat pseudoprimes base $2$, which are critical in establishing the determinism of our test. Through the proof of our main theorem, we demonstrate that our modified test is equivalent to checking the polynomial congruence $(1 + x)^n \equiv 1 + x^n \pmod{n} \in \mathbb{Z}[x]$, which is known to hold for only prime integers $n$ \cite{granville2004primes}.

\subsection{Structure of the Paper}
This paper is structured as follows: We begin by presenting the main theorem which defines our primality test. We follow up with supporting lemmas and theorems. Then, we present the proof of our main theorem, which demonstrates the test's validity for odd prime numbers and its failure for odd composite numbers. Through this, we establish the deterministic nature of our test. We then describe the algorithm used to compute our test and analyze its computational complexity. We conclude with a link to an open source implementation of our test.

\section{Statement of Main Theorem}
\begin{theorem}[Main theorem]
\label{theorem:main}
Let $n > 3$ be an odd integer such that $2^{n-1} \equiv 1 \pmod{n}$. Let $d > 2$ be the least prime integer such that $n \not\equiv 1 \pmod{d}$. If the following polynomial congruence holds, then either $n$ is prime or $n$ has a prime divisor $p \leq d$:
\begin{align}
(1 + x)^n \equiv 1 + x^n \pmod{n, x^d - 2}
\end{align}
\end{theorem}

\section{Supporting Lemmas and Theorems}

\subsection{Supporting Lemmas}
\begin{lemma} \label{lemma:floornondivisor}
Given $a,b \in \Z^{+}$ with \(b \nmid a\) and \( 1 < b < \left\lfloor \frac{a}{b} \right\rfloor \), then \(\left\lfloor \frac{a}{b} \right\rfloor \) cannot divide \(a\).
\end{lemma}
\begin{proof}
Let \(q = \left\lfloor \frac{a}{b} \right\rfloor\). By definition, \(q\) is the greatest integer that is less than \(\frac{a}{b}\). Thus, \(q \cdot b < a < b \cdot (q + 1)\).

Suppose, for contradiction, that \(q\) divides \(a\). Then there exists an integer \(k\) such that \(a = k \cdot q\). Substituting \(a = k \cdot q\) into the inequality \(q \cdot b < a < b \cdot (q + 1) \), we get \(q \cdot b < k \cdot q < b \cdot (q + 1) \). Dividing this inequality by \(q\), we obtain \(b < k < b + \frac{b}{q}\).

Since \(k\) is an integer, and \(b \nmid a\) implies \(k \neq b\), the next possible integer value for \(k\) is \(b + 1\). Therefore, \(k = b + 1\), which gives \(a = k \cdot q = q \cdot (b + 1)\). However, this leads to a contradiction: \(a = q \cdot (b + 1) \) implies \(a \geq b \cdot (q + 1) \), contradicting the established fact that \(a < b \cdot (q + 1) \). Hence, our assumption that \(q\) divides \(a\) is false. Therefore, \(\left\lfloor \frac{a}{b} \right\rfloor \nmid a\).
\end{proof}

\begin{lemma}[Upper bound on floor function and indivisibility]
\label{lemma:floornondivisorupperbound}
Given $a,b \in \Z^{+}$ with \( 1 < b < \left\lfloor \frac{a}{b} \right\rfloor \), then \(b \leq \left\lfloor \sqrt{a} \right\rfloor\).
\end{lemma}
\begin{proof}
Assume \( a, b \in \Z^{+} \) and \( 1 < b < \left\lfloor \frac{a}{b} \right\rfloor \). By definition, \( \left\lfloor \frac{a}{b} \right\rfloor \) is the greatest integer less than or equal to \( \frac{a}{b} \). Hence, \( \left\lfloor \frac{a}{b} \right\rfloor \leq \frac{a}{b} \). Since \( b < \left\lfloor \frac{a}{b} \right\rfloor \), we have \( b^2 < b \cdot \left\lfloor \frac{a}{b} \right\rfloor \leq a \). Taking square roots on both sides of the inequality \( b^2 < a \) and considering that \( b \) and \( \sqrt{a} \) are both positive, we get \( b < \sqrt{a} \). Since \( b \) and \( \sqrt{a} \) are positive integers, and \( b < \sqrt{a} \), it follows that \( b \leq \left\lfloor \sqrt{a} \right\rfloor \).
\end{proof}

\begin{lemma}[Upper bound on $d$] \label{lemma:leastd}
Let $n$ be an odd composite integer $>3$. Then there exists an odd prime integer $d \leq (1 + o(1)) \log(n)$ such that $n \not\equiv 0 \pmod{d}$.
\end{lemma}
\begin{proof}
Define $f(n)$ as the least odd prime not dividing $n$. For primorials $q_m = \prod_{k=1}^m p_k$, with $m \geq 2$, $f(q_m)$ is the $(m+1)$-th prime, as $q_m$ is divisible by the first $m$ primes (including 2).

By the Prime Number Theorem, $p_m \approx m \log m$, so for a primorial $q_m$, $f(q_m) = p_{m+1} \approx (m+1) \log (m+1)$. 

Since the function $f$ is maximized at primorials, for a general $n$, especially when $n$ is large and not necessarily a primorial, we can estimate that $f(n) \leq (1+o(1))\log n$. This upper bound is asymptotic and becomes more accurate for larger $n$.

Therefore, for any odd composite integer $n$, the least odd prime non-divisor of $n$ is bounded above by $(1+o(1))\log n$.
\end{proof}

\textbf{Remark.} The proof for \cref{lemma:leastd} was adapted from a proof given by a MathOverflow user \cite{leastcoprime2021}.

\begin{lemma}[Incongruence modulo $n$] \label{lemma:incongruencemodn}
Let \( n > 3 \) be an odd composite integer such that \( 2^{n-1} \equiv 1 \pmod{n} \). Denote by \( d \) the least prime integer \( > 2 \) which does not divide \( n-1 \). Then, \( 2^{\left\lfloor\frac{n-1}{d}\right\rfloor} \not\equiv 1 \pmod{n} \).
\end{lemma}
\begin{proof}
Consider an odd composite integer \( n > 3 \) for which \( 2^{n-1} \equiv 1 \pmod{n} \). According to the properties of the multiplicative order modulo $n$, the smallest positive integer \( k \) such that \( 2^k \equiv 1 \pmod{n} \) defines \( \ordn{2} \), that is, \( k = \ordn{2} \). Since $n$ is composite and \( 2^{n-1} \equiv 1 \pmod{n} \), this order, \( \ordn{2} \), must divide \( n-1 \).

Given \( d \) is the least prime integer greater than $2$ and less than \( n \) that does not divide \( n-1 \), and \( \ordn{2} \) divides \( n-1 \), it follows that $d$ cannot equal \( \ordn{2} \). Furthermore, by Lemma \ref{lemma:floornondivisor}, we know that if an integer \( b \) does not divide an integer \( a \), and \( 1 < b < \left\lfloor \frac{a}{b} \right\rfloor \), then \( \left\lfloor \frac{a}{b} \right\rfloor \) does not divide \( a \).

Applying this to our current context with \( a = n-1 \) and \( b = d \): The least odd composite integer such that \( 2^{n-1} \equiv 1 \pmod{n} \) is $341$ \cite{oeisfermatpspbase2}. By Lemma \ref{lemma:leastd}, we have $d \leq (1 + o(1)) \log(n)$, which is significantly less than $\left\lfloor\sqrt{n}\right\rfloor$ as $n$ grows large. For $n \geq 341$, clearly $d < \left\lfloor\sqrt{n}\right\rfloor$ which satisfies Lemma \ref{lemma:floornondivisorupperbound}. Thus we have \( 1 < d < \left\lfloor \frac{n-1}{d} \right\rfloor \) and hence, \( \left\lfloor \frac{n-1}{d} \right\rfloor \) cannot divide \( n-1 \).

By the properties of the order of an integer modulo composite $n$, the smallest $k \in \mathbb{Z}$ such that $2^k \equiv 1 \pmod{n}$, that is $k = \ordn{2}$, must be a divisor of $n-1$. Hence, $\ordn{2} \mid n-1$. Since $\left\lfloor\frac{n-1}{d}\right\rfloor$ is strictly less than $n-1$ and $d$ does not divide $n-1$, it follows that $2^{\left\lfloor\frac{n-1}{D}\right\rfloor} \not\equiv 1 \pmod{n}$.
\end{proof}

\begin{lemma} \label{lemma:nonresidue}
Let $n>3$ be an odd composite integer such that $2^{n-1} \equiv 1 \pmod{n}$. Let $d > 2$ be the least prime integer such that $n \not\equiv 1 \pmod{d}$. If $2^{\floor{\frac{n-1}{d}}} \not\equiv 1 \pmod{n}$, then $n$ has at least one prime divisor $p$ such that $2$ is not a $d$th power residue modulo $p$. That is, there are no solutions $b \in \mathbb{Z_p}$ such that $b^d \equiv 2 \pmod{p}$.
\end{lemma}
\begin{proof}
Let $p \in \mathbb{Z}$ be prime and $\beta = \gcd(p-1, d)$. Euler's criterion \cite{euler1914powerresidues} states that $a \not\equiv 0 \pmod p$ is a $d$th power residue modulo $p$ if and only if:
\begin{align}
a^{\frac{p-1}{\beta}} \equiv 1 \pmod p
\end{align}

Applying to Euler's criterion to our situation, since $p$ and $d$ are both odd primes and $p \not= d$, we have that $a=2$ is a $d$th power residue modulo $p$ if and only if $d \mid p-1$ and $2^{\frac{p-1}{d}} \equiv 1 \pmod p$.

For the sake of contradiction, let's assume that for all prime divisors $p_j$ of $n$, $d \mid p_j-1$ and $2^{\frac{p_j-1}{d}} \equiv 1 \pmod p_j$. Then by the Chinese Remainder Theorem (CRT) \cite{cormen2009algorithms}, we must have $d \mid n-1$. However, this is a contradiction, as we have defined $d$ such that $n \not\equiv 1 \pmod{d}$.

Furthermore, by the properties of the multiplicative order modulo composite $n$, we must also have $2^{\floor{\frac{n-1}{d}}} \equiv 1 \pmod p$. However, this also conflicts with our definition of $n$ which has $2^{\floor{\frac{n-1}{d}}} \not\equiv 1 \pmod n$.

Therefore, we conclude that there must exist at least one prime divisor $p$ of $n$ such that $2^{\floor{\frac{p-1}{d}}} \not\equiv 1 \pmod{p}$. For this $p$, Euler's criterion fails to hold, and thus it follows that $2$ is not a $d$th power residue modulo $p$.
\end{proof}

\subsection{Supporting Theorems}

\subsection{Primes Case}
\begin{theorem}[Primes pass] \label{theorem:primes}
Let $n$ be an odd prime integer such that $n > 3$. Let $d > 2$ be the least prime integer such that $n \not\equiv 1 \pmod{d}$. Then $(1 + x)^n \equiv 1 + x^n \pmod{n, x^d - 2}$.
\end{theorem}
\begin{proof}
We aim to show that the following polynomial congruence holds for all odd prime integers $n > 3$:
\begin{align}
    (1 + x)^n \equiv 1 + x^n \pmod{n, x^d - 2},
\end{align}
where $d$ is the least prime integer greater than $2$ such that $n \not\equiv 1 \pmod{d}$.

We begin by taking the binomial expansion of the left-hand side:
\begin{align}
    \sum_{k=0}^{n} \binom{n}{k} x^k \equiv 1 + x^n \pmod{n, x^d - 2}
\end{align}

When $n$ is prime, $\binom{n}{k} \equiv 0 \pmod{n}$ for all integers $k$ in the range $1 \leq k \leq n-1$. Thus, we have $\sum_{k=1}^{n-1} \binom{n}{k} x^k \equiv 0 \pmod{n, x^d - 2}$. With this in mind, we isolate the inner terms in our original congruence and simplify:
\begin{align}
    & \binom{n}{0} x^0 + \binom{n}{n} x^n + \sum_{k=1}^{n-1} \binom{n}{k} x^k \equiv 1 + x^n \pmod{n, x^d - 2} \\
    & \binom{n}{0} x^0 + \binom{n}{n} x^n \equiv 1 + x^n \pmod{n, x^d - 2}
\end{align}

By the binomial theorem, we have $\binom{n}{0} = \binom{n}{n} = 1$ for all $n \in \mathbb{Z}$. Substituting values and simplifying further reveals:
\begin{align}
    & 1 \cdot x^0 + 1 \cdot x^n \equiv 1 + x^n \pmod{n, x^d - 2} \\
    & 1 + x^n \equiv 1 + x^n \pmod{n, x^d - 2}
\end{align}

Hence, we have shown that the left-hand side of the congruence is equal to the right-hand side when $n$ is prime. Therefore, we conclude that the polynomial congruence holds under the given conditions.
\end{proof}

\subsection{Composites Case}

A fundamental theorem in polynomial ring theory states that an integer $n$ is prime if and only if $(1 + x)^n \equiv 1 + x^n \pmod{n} \in \Z[x]$ \cite{granville2004primes}. This congruence was used as the basis for the AKS test \cite{aks2002}. A short proof of the theorem, given by Granville (2004) \cite{granville2004primes}, is that since $(x + 1)^n - (x^n + 1) = \sum_{k=1}^{n-1} \binom{n}{k} x^k$, we may have $(1 + x)^n \equiv 1 + x^n \pmod{n}$ if and only if $n$ divides $\binom{n}{k}$ for all $k$ in the range $1 \leq k \leq n-1$. It is important to note that for the polynomial congruence to be valid, $x^n$ and $(1+x)^n$ must be irreducible in $\Z_n[x]$.

Kopparty and Wang (2014) \cite{koppartywang2014roots} proved several interesting theorems related to limits on the counts of consecutive zero coefficients in polynomials over finite fields. We take significant inspiration from their approach to show that composite integers will always fail our test.

\begin{theorem}[Composites case] \label{theorem:composites}
Let $n = pq$ be an odd composite integer greater than $3$ such that $2^{n-1} \equiv 1 \pmod{n}$, with $p$ a prime divisor. Let $d > 2$ be the least prime integer such that $n \not\equiv 1 \pmod{d}$. Suppose $n$ does not have a prime divisor $\leq d$ and $x^n \not\equiv 1 \pmod{n, x^d-2}$. Then $(1 + x)^n \not\equiv 1 + x^n \pmod{n, x^d-2}$.
\end{theorem}
\begin{proof}
First, consider the polynomial $f(x) = (1 + x)^n - (1 + x^n) \in \mathbb{Z}_n[x]$. Notice that taking $f(x)$ modulo $x^d - 2$ and asserting that the result is nonzero is equivalent to showing $(1 + x)^n \not\equiv 1 + x^n \pmod{n, x^d-2}$.

We are given composite $n$ with $x^n \not\equiv 1 \pmod{n, x^d-2}$. In the quotient ring $\mathbb{Z}_n[x]/(x^d-2)$, we have $x^d = 2$ and thus:
\begin{align}
    \left(x^n = (x^{\frac{1}{d}})^n = 2^{\floor{\frac{n}{d}}}\right) \not\equiv 1 \pmod{n,x^d-2}
\end{align}

Since $n$ is odd and $d > 2$, by the properties of the floor function, $\left\lfloor\frac{n}{d}\right\rfloor = \left\lfloor\frac{n-1}{d}\right\rfloor$. It follows that:
\begin{align}
    \left(2^{\left\lfloor\frac{n}{d}\right\rfloor} = 2^{\left\lfloor\frac{n-1}{d}\right\rfloor}\right) \not\equiv 1 \pmod{n,x^d-2}
\end{align}

If $f(x) \pmod{x^d-2}$ is to be zero in $\mathbb{Z}[x]_n$, it is necessary that $f(x)$ be zero modulo all of the individual prime factors of $n$ up to at least the prime power that appears in the prime factorization of $n$. This is because if any of the polynomial's coefficients are indivisible by any prime power $p^k$ dividing $n$ (and thus any $p^j$ in $\{ p^j \text{ } | \text{ } 1 < j \leq k \}$), then they cannot be divisible by $n$ (since $n$ is the unique product of its prime factorization).

Hence, to prove the theorem, it suffices to show that under the given conditions, there must exist a prime divisor $p$ of $n$ such that $f(x) = (1 + x)^n - (1 + x^n) \in \mathbb{Z}_p[x]$ is nonzero when reduced modulo $x^d - 2$. Or equivalently, that $(1 + x)^n \not\equiv 1 + x^n \pmod{p, x^d-2}$.

Under the given conditions, by \cref{lemma:nonresidue}, there must exist at least one prime divisor $p$ of $n$ such that $2$ is not a $d$th power residue modulo $p$.

Now, consider the polynomial ring $\mathbb{Z}_p[x]$. We examine the reduction of $f(x) \pmod{x^d - 2} \in \mathbb{Z}[x]_p$, which is the same as $f(x) \in \mathbb{Z}_p[x]/(x^d - 2)$. After reduction modulo $x^d - 2$, the polynomial $f(x)$ has $\deg(f(x)) = d-1$, and can be written as $f(x) = \sum_{i=0}^{d-1} c_i x^i$.

Assume for contradiction that $f(x)$ is the zero polynomial in $\mathbb{Z}_p[x]/(x^d - 2)$. This would imply that all coefficients $c_i$ are zero.

Since $p$ is prime, $\mathbb{Z}_p$ is a finite field and $\mathbb{Z}_p[x]$ is a polynomial ring over this field. We aim to establish that $\mathbb{Z}_p[x]/(x^d - 2)$ forms a field. To do so, we must show that $x^d - 2$ is irreducible over $\mathbb{Z}_p[x]$.

We recall a classical theorem from field theory (Irreducibility Theorem) \cite{karpilovsky1989fields}:

\textit{Suppose $c \in F$ where $F$ is a field, and $0 < d \in \mathbb{Z}$. The polynomial $x^k - c$ is irreducible over $F$ if and only if $c$ is not a $q$th power in $F$ for any prime $q$ dividing $k$, and $c$ is not in $-4F^4$ when $4$ divides $k$.}

In our case, $F = \mathbb{Z}_p$, $c = 2$, and $k = d$, where $d$ is prime.

Regarding the first criterion, given $d$ is prime, $d$ does not have any divisors $q$, and hence it suffices to check only $d$ itself. We have chosen $p$ such that $2$ is not a $d$th power residue modulo $p$, which informs that there is no element $b \in \mathbb{Z}_p$ such that $b^d \equiv 2 \pmod{p}$. The first criterion is satisfied. Since $d$ is prime, it is not divisible by $4$, and thus second criterion is also satisfied.

By the Irreducibility Theorem, $x^d - 2$ is irreducible over $\mathbb{Z}_p[x]$ and hence, the quotient ring $\mathbb{Z}_p[x]/(x^d - 2)$ forms a finite field.

In a finite field, a polynomial of degree $r$ can have at most $r$ roots \cite{dummit2004abstractalgebra}. This is because a polynomial of degree $r$ in a finite field can be factored into at most $r$ linear factors (each corresponding to a root), within an algebraic closure of that field. However, within the field itself, the number of roots can be fewer than $r$, but never more.

In our case, if $\mathbb{Z}_p[x]/(x^d - 2)$ is a finite field and $\deg(f(x)) = d-1$, then $f(x)$ can have at most $d-1$ roots in this field. The assumption that $f(x)$ is the zero polynomial is a direct contradiction unless $p \leq d-1$, as it would necessarily imply that $f(x)$ has infinitely many roots (or more precisely, that every element of $\mathbb{Z}_p$ is a root) \cite{koppartywang2014roots}. However, this is clearly not the case, as we are given $n$ which does not have a prime divisor $\leq d$.

Therefore, we conclude that under the given conditions, $f(x)$ must be nonzero in $\mathbb{Z}_p[x]/(x^d - 2)$ for at least one prime $p$ which divides $n$ and therefore, $(1 + x)^n \not\equiv 1 + x^n \pmod{n, x^d-2}$. This completes the proof.
\end{proof}

\section{Proof of the Main Theorem}
\begin{proof}[Proof of Theorem \ref{theorem:main}]
Let $n$ be an odd integer $>3$ such that $2^{n-1} \equiv 1 \pmod{n}$. Let $d > 2$ be the least prime integer such that $n \not\equiv 1 \pmod{d}$.

\textbf{Case 1}: $n$ is prime

If $n$ is prime, then by $\cref{theorem:primes}$, the polynomial congruence holds and $n$ passes the test as expected.

\textbf{Case 2}: $n$ is composite
If $n$ composite, suppose $n$ has a prime divisor $\leq d$. Clearly, it fails the test as expected.

If $n$ does not have a prime divisor $\leq d$, then by \cref{lemma:incongruencemodn} we infer $2^{\floor{\frac{n-1}{d}}} \not\equiv 1 \pmod{n}$. By \cref{lemma:nonresidue}, it follows that $n$ must have a prime divisor $p$ such that $2$ is not a $d$th power residue modulo $p$. Hence, all of the necessary preconditions for \cref{theorem:composites} are satisfied and it applies. By \cref{theorem:composites}, the polynomial congruence cannot hold, and therefore $n$ fails the test as expected.

\textbf{Conclusion}:

Under the given conditions, when $n$ is prime, the polynomial congruence holds and $n$ passes the test as expected. When $n$ is composite, the polynomial congruence does not hold and $n$ fails the test as expected. The theorem is proven.
\end{proof}

\section{Algorithm} \label{section:algorithm}
\textbf{INPUT}: An integer $n > 1$.
\begin{center}
    \begin{enumerate}
        \item If $n \equiv 0 \mod{2}$:
            \begin{enumerate}
                \item If $n$ equals $2$, output PRIME.
                \item Otherwise, output COMPOSITE.
            \end{enumerate}
        \item If $n$ equals $3$, output PRIME.
        \item If $2^{n-1} \bmod{n}$ does not equal $1$, output COMPOSITE.
        \item Find the least prime integer $d$ that is greater than $2$ such that $n \not\equiv 1 \pmod{d}$.
        \item If $n$ has a prime divisor less than $d$, output COMPOSITE.
        \item Compute the polynomial expansion of $x^n \bmod{n}$ in the ring $\Z_n[x]/(x^d-2)$ with degree $d$, and store the result.
        \item Compute the polynomial expansion of $(1 + x)^n \bmod{n}$ in the ring $\Z_n[x]/(x^d-2)$ with degree $d$, and store the result.
        \item If $(1 + x)^n \not= 1 + x^n$, output COMPOSITE.
        \item Output PRIME;
    \end{enumerate}
\end{center}

\subsection{Time Complexity Analysis} \label{subsection:timecomplexity}
The given algorithm is a primality test that involves several computational steps, including modular arithmetic and polynomial exponentiation in the ring $\Mx$. In this subsection, we use $M(n)$ to denote the worst-case time complexity of integer multiplication in terms of $n$.

\subsubsection{Analysis of Individual Operations}
\begin{enumerate}
    \item \textbf{Check for Even \( n \)}:
    
        This step involves calculating $n \bmod{2}$ and has a time complexity of \( T_1(n) = O(1) \).

    \item \textbf{Finding \( d \)}:
    
        Finding the least prime integer \( d > 2 \) such that $n \not\equiv 1 \pmod{d}$ takes at most \( O((1 + o(1))\log(n)) \) steps (See \cref{lemma:leastd}), with each step requiring \( O(1) \) time for the mod operation. Hence, the overall complexity is \(  T_2(n) = O((1 + o(1))\log(n)) \).

    \item \textbf{Computing \( x^n \bmod{n, x^d-2} \)}:
    
        Computing the polynomial expansion of $x^n \pmod{n}$ in the ring \( \Mx \) with degree $d$ is equivalent to calculating $2^{\floor{\frac{n}{d}}} \pmod{n}$. This step requires modular exponentiation with a \( \log(n) \)-digit base and a \( \log(n) \)-digit exponent. The time complexity of modular exponentiation is \(  T_3(n) = O(\log(n) M(n)) \).

    \item \textbf{Computing \( (1+x)^n \bmod{n, x^d-2} \)}:
    
        Computing the polynomial expansion of \( (1+x)^n \pmod{n} \) in the ring \( \Z_n[x]/(x^d-2) \)  with degree $d$ involves exponentiating a polynomial in $\Z_n[x]/(x^d-2)$ with \( D = O((1 + o(1))\log(n)) \) terms. Exponentiation using repeated squaring takes \( O(\log(n)) \) steps, and each step requires \( O((1 + o(1)) \log(n) M(n)) \) time due to the multiplication of polynomials of size \( O((1 + o(1)) \log(n)) \). Therefore, the overall complexity of this step is \(  T_4(n) =O((1 + o(1)) \log^2(n) M(n)) \).
         
    \item \textbf{Checking the equality \( (1+x)^n = 1 + x^n \pmod{n} \in \Z_n[x]/(x^d-2) \)}:
        The final steps involve comparing the equality of coefficients in the polynomials $(1+x)^n$ and $1 + x^n$. This requires $O(\log(n))$ comparisons, which are themselves \( O(1) \) operations. The overall time complexity of this step is $T_5(n) = O(\log(n))$.
\end{enumerate}

\subsubsection{Overall Time Complexity}
The dominant time complexity in the algorithm comes from computing \( (1+x)^n \pmod{n} \in \Z_n[x]/(x^d-2) \). Therefore, the overall time complexity of the algorithm is \( T(n) = O((1 + o(1)) \log^2(n) M(n)) \).

Harvey and van Der Heoven (2021) \cite{harveyvanderhoeven2021} have given an algorithm for integer multiplication which has a time complexity $M(n) = O(\log(n) \log\log(n))$. This would give our algorithm an overall time complexity of:
\begin{align}
    T(n) &= O((1 + o(1)) \log^2(n) M(n)) \\ &= O((1 + o(1)) \log^2(n) \log(n) \log\log(n)) \\ &= O((1 + o(1)) \log^3(n) \log\log(n))
\end{align}

In soft-O notation \cite{gathengerhard2013softo}, typically denoted as $\tilde{O}$, simplicity is achieved by omitting slower-growing logarithmic and lower-order factors that do not significantly contribute to the overall growth rate of the function.

In the context of our time complexity $T(n) = O((1 + o(1)) \log^3(n) \log\log(n))$, where the dominant term is \(O(\log^3(n))\), the linear factors \(1 + o(1)\) and \(\log\log(n)\) are omitted, and the time complexity simplifies to:
\begin{align}
    \tilde{T}(n) = \tilde{O}(\log^3(n))
\end{align}

\subsubsection{Conclusion}
The overall complexity is polynomial in the size of \( n \) when expressed in terms of bit operations, making the algorithm efficient for large values of \( n \).

\section{Implementation Details}
Sample open source .NET and Python implementations, along with test data, are available on the author's Github page \cite{githubrepo}.

\section{Acknowledgements}
I am indebted to Professor Seth Pettie for his invaluable insights and advice on both the content and presentation of this paper. His expertise in academic writing and research methodologies has been incredibly helpful, and I am particularly thankful for his mentorship and constructive criticism that significantly shaped this work. To Professor Pettie: I am forever grateful for your open mindedness and willingness to engage with me. I also extend my gratitude to the graduate students in his department, for the engaging session we shared and their input and earnest interest in my research.

I owe a great deal of inspiration to the proofs by Kopparty and Wang in their paper on polynomial roots and coefficients over finite fields \cite{koppartywang2014roots}. Their ingenious approach was instrumental in the development of the key proof in my paper. I also extend my heartfelt gratitude to Professor Kopparty, for his encouraging and constructive feedback, which came at a challenging time when I was ready to give up.

I extend my sincere gratitude to Professor Oded Goldreich for his guidance and support throughout the publication process at the ECCC. His patience and motivational guidance, particularly during moments of uncertainty, were invaluable. His expertise in navigating the complex landscape of academic publishing has been indispensable.

A special thanks to the community at \url{mersenneforum.org}, particularly to users Charybdis, R. D. Silverman, and Dr. Sardonicus, for their insightful feedback and scrutiny of my earliest proof attempts. Their contributions were fundamental in refining my approach.

\textbf{Disclaimer}: The views and any errors in this paper are solely my own and do not necessarily reflect those of the individuals acknowledged herein.

\begingroup
\raggedright
\bibliographystyle{unsrtnat}
\bibliography{main}
\endgroup

\end{document}